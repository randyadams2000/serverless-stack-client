{"ast":null,"code":"import _regeneratorRuntime from\"/Users/randyadams/notes-app-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/randyadams/notes-app-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/randyadams/notes-app-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useRef,useState,useEffect}from\"react\";import{useParams,useHistory}from\"react-router-dom\";import{API,Storage}from\"aws-amplify\";import{onError}from\"../libs/errorLib\";import{FormGroup,FormControl,ControlLabel}from\"react-bootstrap\";import LoaderButton from\"../components/LoaderButton\";import config from\"../config\";import\"./Notes.css\";import{s3Upload}from\"../libs/awsLib\";export default function Notes(){var file=useRef(null);var _useParams=useParams(),id=_useParams.id;var history=useHistory();var _useState=useState(null),_useState2=_slicedToArray(_useState,2),note=_useState2[0],setNote=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),content=_useState4[0],setContent=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),isLoading=_useState6[0],setIsLoading=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),isDeleting=_useState8[0],setIsDeleting=_useState8[1];useEffect(function(){function loadNote(){return API.get(\"notes\",\"/notes/\".concat(id));}function onLoad(){return _onLoad.apply(this,arguments);}function _onLoad(){_onLoad=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _note,_content,attachment;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return loadNote();case 3:_note=_context.sent;_content=_note.content,attachment=_note.attachment;if(!attachment){_context.next=9;break;}_context.next=8;return Storage.vault.get(attachment);case 8:_note.attachmentURL=_context.sent;case 9:setContent(_content);setNote(_note);_context.next=16;break;case 13:_context.prev=13;_context.t0=_context[\"catch\"](0);onError(_context.t0);case 16:case\"end\":return _context.stop();}}},_callee,null,[[0,13]]);}));return _onLoad.apply(this,arguments);}onLoad();},[id]);function validateForm(){return content.length>0;}function formatFilename(str){return str.replace(/^\\w+-/,\"\");}function handleFileChange(event){file.current=event.target.files[0];}function saveNote(note){return API.put(\"notes\",\"/notes/\".concat(id),{body:note});}function handleSubmit(_x){return _handleSubmit.apply(this,arguments);}function _handleSubmit(){_handleSubmit=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(event){var attachment;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:event.preventDefault();if(!(file.current&&file.current.size>config.MAX_ATTACHMENT_SIZE)){_context2.next=4;break;}alert(\"Please pick a file smaller than \".concat(config.MAX_ATTACHMENT_SIZE/1000000,\" MB.\"));return _context2.abrupt(\"return\");case 4:setIsLoading(true);_context2.prev=5;if(!file.current){_context2.next=10;break;}_context2.next=9;return s3Upload(file.current);case 9:attachment=_context2.sent;case 10:_context2.next=12;return saveNote({content:content,attachment:attachment||note.attachment});case 12:history.push(\"/\");_context2.next=19;break;case 15:_context2.prev=15;_context2.t0=_context2[\"catch\"](5);onError(_context2.t0);setIsLoading(false);case 19:case\"end\":return _context2.stop();}}},_callee2,null,[[5,15]]);}));return _handleSubmit.apply(this,arguments);}function deleteNote(){return API.del(\"notes\",\"/notes/\".concat(id));}function handleDelete(_x2){return _handleDelete.apply(this,arguments);}function _handleDelete(){_handleDelete=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(event){var confirmed;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:event.preventDefault();confirmed=window.confirm(\"Are you sure you want to delete this note?\");if(confirmed){_context3.next=4;break;}return _context3.abrupt(\"return\");case 4:setIsDeleting(true);_context3.prev=5;_context3.next=8;return deleteNote();case 8:history.push(\"/\");_context3.next=15;break;case 11:_context3.prev=11;_context3.t0=_context3[\"catch\"](5);onError(_context3.t0);setIsDeleting(false);case 15:case\"end\":return _context3.stop();}}},_callee3,null,[[5,11]]);}));return _handleDelete.apply(this,arguments);}return/*#__PURE__*/React.createElement(\"div\",{className:\"Notes\"},note&&/*#__PURE__*/React.createElement(\"form\",{onSubmit:handleSubmit},/*#__PURE__*/React.createElement(FormGroup,{controlId:\"content\"},/*#__PURE__*/React.createElement(FormControl,{value:content,componentClass:\"textarea\",onChange:function onChange(e){return setContent(e.target.value);}})),note.attachment&&/*#__PURE__*/React.createElement(FormGroup,null,/*#__PURE__*/React.createElement(ControlLabel,null,\"Attachment\"),/*#__PURE__*/React.createElement(FormControl.Static,null,/*#__PURE__*/React.createElement(\"a\",{target:\"_blank\",rel:\"noopener noreferrer\",href:note.attachmentURL},formatFilename(note.attachment)))),/*#__PURE__*/React.createElement(FormGroup,{controlId:\"file\"},!note.attachment&&/*#__PURE__*/React.createElement(ControlLabel,null,\"Attachment\"),/*#__PURE__*/React.createElement(FormControl,{onChange:handleFileChange,type:\"file\"})),/*#__PURE__*/React.createElement(LoaderButton,{block:true,type:\"submit\",bsSize:\"large\",bsStyle:\"primary\",isLoading:isLoading,disabled:!validateForm()},\"Save\"),/*#__PURE__*/React.createElement(LoaderButton,{block:true,bsSize:\"large\",bsStyle:\"danger\",onClick:handleDelete,isLoading:isDeleting},\"Delete\")));}","map":{"version":3,"sources":["/Users/randyadams/notes-app-client/src/containers/Notes.js"],"names":["React","useRef","useState","useEffect","useParams","useHistory","API","Storage","onError","FormGroup","FormControl","ControlLabel","LoaderButton","config","s3Upload","Notes","file","id","history","note","setNote","content","setContent","isLoading","setIsLoading","isDeleting","setIsDeleting","loadNote","get","onLoad","attachment","vault","attachmentURL","validateForm","length","formatFilename","str","replace","handleFileChange","event","current","target","files","saveNote","put","body","handleSubmit","preventDefault","size","MAX_ATTACHMENT_SIZE","alert","push","deleteNote","del","handleDelete","confirmed","window","confirm","e","value"],"mappings":"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","sourcesContent":["import React, { useRef, useState, useEffect } from \"react\";\nimport { useParams, useHistory } from \"react-router-dom\";\nimport { API, Storage } from \"aws-amplify\";\nimport { onError } from \"../libs/errorLib\";\nimport { FormGroup, FormControl, ControlLabel } from \"react-bootstrap\";\nimport LoaderButton from \"../components/LoaderButton\";\nimport config from \"../config\";\nimport \"./Notes.css\";\nimport { s3Upload } from \"../libs/awsLib\";\n\nexport default function Notes() {\nconst file = useRef(null);\nconst { id } = useParams();\nconst history = useHistory();\nconst [note, setNote] = useState(null);\nconst [content, setContent] = useState(\"\");\nconst [isLoading, setIsLoading] = useState(false);\nconst [isDeleting, setIsDeleting] = useState(false);\n\n  useEffect(() => {\n    function loadNote() {\n      return API.get(\"notes\", `/notes/${id}`);\n    }\n\n    async function onLoad() {\n      try {\n        const note = await loadNote();\n        const { content, attachment } = note;\n\n        if (attachment) {\n          note.attachmentURL = await Storage.vault.get(attachment);\n        }\n\n        setContent(content);\n        setNote(note);\n      } catch (e) {\n        onError(e);\n      }\n    }\n\n    onLoad();\n  }, [id]);\n\nfunction validateForm() {\n  return content.length > 0;\n}\n\nfunction formatFilename(str) {\n  return str.replace(/^\\w+-/, \"\");\n}\n\nfunction handleFileChange(event) {\n  file.current = event.target.files[0];\n}\n\nfunction saveNote(note) {\n  return API.put(\"notes\", `/notes/${id}`, {\n    body: note\n  });\n}\n\nasync function handleSubmit(event) {\n  let attachment;\n\n  event.preventDefault();\n\n  if (file.current && file.current.size > config.MAX_ATTACHMENT_SIZE) {\n    alert(\n      `Please pick a file smaller than ${\n        config.MAX_ATTACHMENT_SIZE / 1000000\n      } MB.`\n    );\n    return;\n  }\n\n  setIsLoading(true);\n\n  try {\n    if (file.current) {\n      attachment = await s3Upload(file.current);\n    }\n\n    await saveNote({\n      content,\n      attachment: attachment || note.attachment\n    });\n    history.push(\"/\");\n  } catch (e) {\n    onError(e);\n    setIsLoading(false);\n  }\n}\n\nfunction deleteNote() {\n  return API.del(\"notes\", `/notes/${id}`);\n}\n\nasync function handleDelete(event) {\n  event.preventDefault();\n\n  const confirmed = window.confirm(\n    \"Are you sure you want to delete this note?\"\n  );\n\n  if (!confirmed) {\n    return;\n  }\n\n  setIsDeleting(true);\n\n  try {\n    await deleteNote();\n    history.push(\"/\");\n  } catch (e) {\n    onError(e);\n    setIsDeleting(false);\n  }\n}\n\nreturn (\n  <div className=\"Notes\">\n    {note && (\n      <form onSubmit={handleSubmit}>\n        <FormGroup controlId=\"content\">\n          <FormControl\n            value={content}\n            componentClass=\"textarea\"\n            onChange={e => setContent(e.target.value)}\n          />\n        </FormGroup>\n        {note.attachment && (\n          <FormGroup>\n            <ControlLabel>Attachment</ControlLabel>\n            <FormControl.Static>\n              <a\n                target=\"_blank\"\n                rel=\"noopener noreferrer\"\n                href={note.attachmentURL}\n              >\n                {formatFilename(note.attachment)}\n              </a>\n            </FormControl.Static>\n          </FormGroup>\n        )}\n        <FormGroup controlId=\"file\">\n          {!note.attachment && <ControlLabel>Attachment</ControlLabel>}\n          <FormControl onChange={handleFileChange} type=\"file\" />\n        </FormGroup>\n        <LoaderButton\n          block\n          type=\"submit\"\n          bsSize=\"large\"\n          bsStyle=\"primary\"\n          isLoading={isLoading}\n          disabled={!validateForm()}\n        >\n          Save\n        </LoaderButton>\n        <LoaderButton\n          block\n          bsSize=\"large\"\n          bsStyle=\"danger\"\n          onClick={handleDelete}\n          isLoading={isDeleting}\n        >\n          Delete\n        </LoaderButton>\n      </form>\n    )}\n  </div>\n);\n}\n"]},"metadata":{},"sourceType":"module"}