{"ast":null,"code":"import { EventStreamMarshaller as EventMarshaller } from \"@aws-sdk/eventstream-marshaller\";\nimport { ReadableStreamtoIterable } from \"./utils\";\nimport { getChunkedStream } from \"./getChunkedStream\";\nimport { getEventMessageStream } from \"./getEventMessageStream\";\nimport { getDeserializingStream } from \"./getDeserializingStream\";\n\nvar EventStreamMarshaller =\n/** @class */\nfunction () {\n  function EventStreamMarshaller(_a) {\n    var utf8Encoder = _a.utf8Encoder,\n        utf8Decoder = _a.utf8Decoder;\n    this.eventMarshaller = new EventMarshaller(utf8Encoder, utf8Decoder);\n  }\n\n  EventStreamMarshaller.prototype.deserialize = function (body, deserializer) {\n    var chunkedStream = getChunkedStream(body);\n    var messageStream = getEventMessageStream(chunkedStream, this.eventMarshaller);\n    var deserialingStream = getDeserializingStream(messageStream, deserializer);\n    return ReadableStreamtoIterable(deserialingStream);\n  };\n  /**\n   * Generate a ReadableStream that serialize events\n   * to event stream binary chunks; Use a pull stream\n   * here to support low connection speed.\n   *\n   * This doesn't work on browser currently because\n   * browser doesn't support upload streaming.\n   * reference:\n   * * https://bugs.chromium.org/p/chromium/issues/detail?id=688906\n   * * https://bugzilla.mozilla.org/show_bug.cgi?id=1387483\n   *\n   */\n\n\n  EventStreamMarshaller.prototype.serialize = function (input, serializer) {\n    throw new Error(\"event stream request in browser is not supported\\nReference: https://bugs.chromium.org/p/chromium/issues/detail?id=688906\");\n  };\n\n  return EventStreamMarshaller;\n}();\n\nexport { EventStreamMarshaller };","map":{"version":3,"sources":["../src/EventStreamMarshaller.ts"],"names":[],"mappings":"AAAA,SAAS,qBAAqB,IAAI,eAAlC,QAAyD,iCAAzD;AAOA,SAAS,wBAAT,QAAyC,SAAzC;AACA,SAAS,gBAAT,QAAiC,oBAAjC;AACA,SAAS,qBAAT,QAAsC,yBAAtC;AACA,SAAS,sBAAT,QAAuC,0BAAvC;;AASA,IAAA,qBAAA;AAAA;AAAA,YAAA;AAEE,WAAA,qBAAA,CAAY,EAAZ,EAAsE;QAAxD,WAAA,GAAA,EAAA,CAAA,W;QAAa,WAAA,GAAA,EAAA,CAAA,W;AACzB,SAAK,eAAL,GAAuB,IAAI,eAAJ,CAAoB,WAApB,EAAiC,WAAjC,CAAvB;AACD;;AAED,EAAA,qBAAA,CAAA,SAAA,CAAA,WAAA,GAAA,UACE,IADF,EAEE,YAFF,EAE0D;AAExD,QAAM,aAAa,GAAG,gBAAgB,CAAC,IAAD,CAAtC;AACA,QAAM,aAAa,GAAG,qBAAqB,CACzC,aADyC,EAEzC,KAAK,eAFoC,CAA3C;AAIA,QAAM,iBAAiB,GAAG,sBAAsB,CAC9C,aAD8C,EAE9C,YAF8C,CAAhD;AAIA,WAAO,wBAAwB,CAAC,iBAAD,CAA/B;AACD,GAdD;AAgBA;;;;;;;;;;;;;;AAYA,EAAA,qBAAA,CAAA,SAAA,CAAA,SAAA,GAAA,UACE,KADF,EAEE,UAFF,EAEmC;AAEjC,UAAM,IAAI,KAAJ,CAAU,2HAAV,CAAN;AAED,GAND;;AAOF,SAAA,qBAAA;AAAC,CAzCD,EAAA","sourcesContent":["import { EventStreamMarshaller as EventMarshaller } from \"@aws-sdk/eventstream-marshaller\";\nimport {\n  Encoder,\n  Decoder,\n  Message,\n  EventStreamMarshaller as IEventStreamMarshaller\n} from \"@aws-sdk/types\";\nimport { ReadableStreamtoIterable } from \"./utils\";\nimport { getChunkedStream } from \"./getChunkedStream\";\nimport { getEventMessageStream } from \"./getEventMessageStream\";\nimport { getDeserializingStream } from \"./getDeserializingStream\";\n\nexport interface EventStreamMarshaller extends IEventStreamMarshaller {}\n\nexport interface EventStreamMarshallerOptions {\n  utf8Encoder: Encoder;\n  utf8Decoder: Decoder;\n}\n\nexport class EventStreamMarshaller {\n  private readonly eventMarshaller: EventMarshaller;\n  constructor({ utf8Encoder, utf8Decoder }: EventStreamMarshallerOptions) {\n    this.eventMarshaller = new EventMarshaller(utf8Encoder, utf8Decoder);\n  }\n\n  deserialize<T>(\n    body: ReadableStream,\n    deserializer: (input: { [event: string]: Message }) => T\n  ): AsyncIterable<T> {\n    const chunkedStream = getChunkedStream(body);\n    const messageStream = getEventMessageStream(\n      chunkedStream,\n      this.eventMarshaller\n    );\n    const deserialingStream = getDeserializingStream(\n      messageStream,\n      deserializer\n    );\n    return ReadableStreamtoIterable(deserialingStream);\n  }\n\n  /**\n   * Generate a ReadableStream that serialize events\n   * to event stream binary chunks; Use a pull stream\n   * here to support low connection speed.\n   *\n   * This doesn't work on browser currently because\n   * browser doesn't support upload streaming.\n   * reference:\n   * * https://bugs.chromium.org/p/chromium/issues/detail?id=688906\n   * * https://bugzilla.mozilla.org/show_bug.cgi?id=1387483\n   *\n   */\n  serialize<T>(\n    input: AsyncIterable<T>,\n    serializer: (event: T) => Message\n  ): ReadableStream {\n    throw new Error(`event stream request in browser is not supported\nReference: https://bugs.chromium.org/p/chromium/issues/detail?id=688906`);\n  }\n}\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}